
<style>
{#Permet de reduire la taille et l'espace du texte du dropdown Taxo Sample#}
#select2-sampleid-results li {font-size: 12px; padding: 3px;}
#TabB .select2-selection__rendered {font-size: 12px; }
</style>

{# ------- Sample ------------#}
<div class="filter ">
	<div class="form-group-sm">
		<label class="title">Sample</label>
		<span title="Available only when a project is selected" data-toggle="tooltip" data-placement="right" class="glyphicon glyphicon-info-sign"></span>
		<a class="pull-right clear" href='javascript:ClearSamples();'></a>
		<select class="form-control" id="sampleid" name="sampleid" style="width: 100%" multiple autocomplete="off"> {{ data.sample_for_select|safe }}</select>
	</div>
</div>
{# ------- Depth ------------#}
<div class="filter ">
	<div class="form-group-sm">
		<label class="title">Depth</label>
		<span title="Positive values. Both values are required. Each object has a min and max depths. Both values must be in the selected range for the object to be displayed." data-toggle="tooltip" data-placement="right" class="glyphicon glyphicon-info-sign"></span>
		<a class="pull-right clear" href='javascript:ClearDepths();'></a>

		<div class="form-inline">
			<div class="input-group" style="width: 49%" >
				<div class="input-group-addon"><span class="glyphicon glyphicon-triangle-bottom"></span></div>
				<input class="form-control" type="text" id="filt_depthmin" autocomplete="off" value="{{ data.depthmin }}" placeholder="Min [m]">
			</div>
			<div class="input-group" style="width: 49%">
				<div class="input-group-addon"><span class="glyphicon glyphicon-triangle-top"></span></div>
				<input class="form-control"  type="text" id="filt_depthmax" autocomplete="off" value="{{ data.depthmax }}"  placeholder="Max [m]">
			</div>
		</div>
	</div>
</div>
{# ------- Position ------------#}
<div class="filter ">
	<div class="form-group-sm">
		<label class="title">Location</label>
		<a class="pull-right clear" href='javascript:ClearCoords();'></a>

		<table>
			<tr>
				<td><input class="form-control" type="text" id="filt_MapOutW" name="filt_MapOutW" value="{{ data.MapW }}" placeholder="West"></td>
				<td><input class="form-control" type="text" id="filt_MapOutN" name="filt_MapOutN"  value="{{ data.MapN }}" placeholder="North">
				<input class="form-control" type="text" id="filt_MapOutS" name="filt_MapOutS" value="{{ data.MapS }}" placeholder="South"></td>
				<td><input class="form-control" type="text" id="filt_MapOutE" name="filt_MapOutE" autocomplete="off" value="{{ data.MapE }}" placeholder="East"></td>
			</tr>
		</table>

		<button type="button" class="btn btn-sm btn-default btn-block" onClick="OpenMap({{ g.Projid }});">Open map</button>
	</div>
</div>
{# ------- Dates ------------#}
<div class="filter ">
	<div class="form-group-sm">
		<label class="title">Date</label>
		<a class="pull-right clear" href='javascript:ClearDates();'></a>
		<input class="form-control" type="text" style="width: 100%" id="filt_fromdate" name="filt_fromdate" value="{{ data.fromdate }}" autocomplete="off" placeholder="Begin">
		<input class="form-control" type="text" style="width: 100%" id="filt_todate" name="filt_todate" value="{{ data.todate }}" autocomplete="off" placeholder="End">
	</div>
</div>
{# ------- Times ------------#}
<div class="filter ">
	<div class="form-group-sm">

		<label class="title">Time</label>
		<input type="checkbox" value="Y" id="filt_inverttime" name="filt_inverttime" autocomplete="off" {{ "checked" if data.inverttime=='1' }}> <label for="filt_inverttime">invert</label>
		<a class="pull-right clear" href='javascript:ClearTimes();'></a>
		<form class="form-inline">
			<input class="form-control" type="text" style="width: 49%" id="filt_fromtime" name="filt_fromtime" autocomplete="off" value="{{ data.fromtime }}" placeholder="Begin">
			<input class="form-control" type="text" style="width: 49%" id="filt_totime" name="filt_totime" autocomplete="off" value="{{ data.totime }}" placeholder="End">
		</form>

		<div style="margin: 7px" id="time-slider-range"></div>
	</div>
</div>

<script>
function OpenMap(projid) {
    $("#PopupDetails .modal-content").html("Loading...");
    $('#PopupDetails .modal-lg').css('width',$(window).width()-40);
    $('#PopupDetails').modal({});
    var url="/search/mappopup/"
    if(typeof (projid)!="undefined")
      url+="?projid="+projid
    $("#PopupDetails .modal-content").load(url);
}
function ClearCoord() {
  $("#filt_MapOutN,#filt_MapOutW,#filt_MapOutE,#filt_MapOutS").val("");
}
function ClearDates(){
  $( "#filt_fromdate,#filt_todate" ).val("");
}
function ClearDepths(){
  $( "#filt_depthmin,#filt_depthmax" ).val("");
}
function ClearTimes(){
  $("#filt_fromtime,#filt_totime" ).val("");
  $("#filt_inverttime").prop("checked",false);
}
function ClearSamples(){
  $( "#sampleid" ).val(null).trigger("change");
}
function UpdateTimeSliderColor(){
    if($("#filt_inverttime").prop("checked")) {
       $("#time-slider-range .ui-slider-range").css('background-color','#fff')
       $("#time-slider-range").css('background-color','#555')
    } else    {
       $("#time-slider-range .ui-slider-range").css('background-color','#555')
       $("#time-slider-range").css('background-color','#fff')
    }
}

$(document).ready(function() {
  

    $("#sampleid").select2({
        ajax: {
            url: "/search/samples",
            dataType: 'json',
            delay: 250,
            data: function (params) {  return { q: params.term  ,projid:$('#projid').val() };  },
            processResults: function (data, page) { return { results: data};  },
            cache: true
        },
        dropdownCssClass:"width400"
    }); // Select2 Ajax

      $( "#filt_fromdate,#filt_todate" ).datepicker({
      showButtonPanel: true,changeMonth: true,changeYear: true,dateFormat:"yy-mm-dd",
    });

    $( "#time-slider-range" ).slider({
      range: true,
      min: 0,
      max: 1439,
      values: [ 0, 1439 ],
      slide: function( event, ui ) {
        v=ui.values[ 0 ];
        v=Math.floor(v/60)+":"+(("00"+(v% 60)).substr(-2));
        $( "#filt_fromtime" ).val(  v);
        v=ui.values[1];
        v=Math.floor(v/60)+":"+(("00"+(v% 60)).substr(-2));
        $( "#filt_totime" ).val( v );
      }
    });
    $("#filt_inverttime").change(function(){
			UpdateTimeSliderColor();
		});
    UpdateTimeSliderColor();
});
</script>