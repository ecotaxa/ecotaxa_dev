<div style="margin: 3px;">
Particle Project {{ PrjId }} : {{ Prj.ptitle }}<br>

<a href="/Task/Create/TaskPartZooscanImport?p={{ PrjId }}" class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-import"></span> Import sample from disk</a>
<a href="/part/prjedit/{{ PrjId }}" class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-pencil"></span> Edit project metadata</a>
<a href="/part/prj/" class="btn btn-sm btn-primary"><span class="glyphicon glyphicon-arrow-left"></span> Back to project list</a>

{{ VisibilityText |safe }}
<h4>Project samples dashboard <a href="#general-help" data-toggle="collapse" class="help"> </a></h4>
<div id="general-help" class="collapse panel panel-default" style="width: 800px;margin-left: 50px;">
  <div class="panel-body">
INFORMATIONS :<br>
This dashboard permits to : <br>
* control the status of the imported samples<br>
* to edit metadata from individual samples<br>
* to reprocess histograms, match ecotaxa samples, re-compute taxonomy histogram or import CTD data after you<br>
 - modify metadata<br>
 - associate an Ecotaxa project<br>
 - annotate vignettes in Ecotaxa<br>
 - modify the CTD files<br>
* to remove all or selected samples from the project<br>
DO NOT FORGET TO SELECT THE SAMPLES THAT YOU WANT TO REPROCESS BEFORE STARTING OPERATIONS

  </div>
</div>
<form action="/part/prjcalc/{{ PrjId }}" method="post" id="FormSamples">
<table id="tblsample2" class="table table-bordered table-condensed" style="width: auto;">
 <thead>
  <tr>
    <th style="text-align: center;">Select
    <br><input type="checkbox" id="checkall" onclick="$('#tblsample2 td input').prop('checked',$(this).prop('checked'))" >
    </th>
    <th>ID</th>
    <th>profileid</th>
    <th>filename</th>
    <th>station ID</th>
    <th>first image</th>
    <th>last img</th>
    <th>last img used</th>
    <th>Descent Filtered Rows</th>
    <th>Removed empty slice</th>
    <th>Sample Date</th>
    <th>Raw Part. Histo</th>
    <th>Det Part. Histo</th>
    <th>Reduced Part. Histo</th>
    <th>Ecotaxa Sample ID</th>
    <th>Taxonomy Histo</th>
    <th>Taxonomy Recalc Date</th>
    <th>CTD Data</th>
    <th>CTD Import Date</th>
    <th>comment</th>
  </tr>
</thead><tbody>
{% for r in dbsample %}
  <tr>
    <td><input type="checkbox" name="s_{{ r['psampleid'] }}" value="Y" ></td>
    <td>{{ r['psampleid'] }} <a href="/part/sampleedit/{{ r['psampleid'] }}"><span class="glyphicon glyphicon-pencil"></span></a></td>
    <td>{{ r['profileid'] }}</td>
    <td>{{ r['filename'] }}</td>
    <td>{{ r['stationid'] }}</td>
    <td>{{ r['firstimage'] or ""}}</td>
    <td>{{ r['lastimg'] or ""}}</td>
    <td>{{ r['lastimgused'] or "" }}</td>
    <td>{{ r['imp_descent_filtered_row'] or "" }}</td>
    <td>{{ r['imp_removed_empty_slice'] or "" }}</td>
    <td>{{ r['sampledate'].strftime('%Y-%m-%d') if r['sampledate'] is not none else "" }}</td>
    <td>{{ r['histobrutavailable'] }}</td>
    <td>{{ r['nbrlinedet'] }}</td>
    <td>{{ r['nbrlinereduit'] }}</td>
    <td>{{ r['sampleid'] or ''}}</td>
    <td>{{ r['nbrlinetaxo'] }}</td>
    <td>{{ r['daterecalculhistotaxo']|datetime }}</td>
    <td>{{ r['nbrlinectd'] }}</td>
    <td>{{ r['ctd_import_datetime']|datetime }}</td>
    <td>{{ r['comment'] }}</td>
  </tr>
  {% endfor %}
</tbody>
</table>
<p >
  <b>Action : </b>
<input type="checkbox" name="dohistodet" value="Y"> Compute detailled histogram
- <input type="checkbox" name="dohistored" value="Y"> Compute reduced histogram
- <input type="checkbox" name="domatchecotaxa" value="Y"> Match Ecotaxa sample
- <input type="checkbox" name="dohistotaxo" value="Y"> Compute taxonomy histogram
- <input type="checkbox" name="doctdimport" value="Y"> CTD Import
  <button type="submit" class="btn btn-primary"><span class="glyphicon glyphicon-cog"></span> Start operation</button>
</p>
</form>
</div>
<button type="button" onclick="$('#confirm').modal('show')" class="btn btn-xs btn-danger"><span class="glyphicon glyphicon-erase"></span> Remove selected samples</button>


<div class="modal " id="confirm" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="ModalLabel">Are you sure you want remove selected samples</h4>
      </div>
      <div class="modal-body">

    <button type="button" onclick="ProcessDeleteSamples()" class="btn btn-danger"><span class="glyphicon glyphicon-erase"></span> Confirm Remove samples</button>

    <button  type="button" class="btn btn-warning" onclick="$('#confirm').modal('hide')"> Cancel</button>

      </div>
    </div>
  </div>
</div>
<script src="/static/common.js"></script>
<link rel="stylesheet" type="text/css" href="/static/DataTables-1.10.15/css/dataTables.bootstrap.css"/>
<style>
#tblsample2_wrapper {margin-top: -40px;}
</style>
<script type="text/javascript" src="/static/DataTables-1.10.15/js/jquery.dataTables.js"></script>
<script type="text/javascript" src="/static/DataTables-1.10.15/js/dataTables.bootstrap.js"></script>
<script>
  function ProcessDeleteSamples()
  {
    var postdata={'delete':'Y'};
    var champs=$('#FormSamples').serializeArray();
    for(i=0;i<champs.length;i++){
      var c=champs[i];
      postdata[c['name']]=c['value'];
    }
    PostDynForm("/part/prjcalc/{{ PrjId }}",postdata);
  }

$(document).ready(function(){
    $('#tblsample2').DataTable({
       "paging":   false
      ,"order": [[ 3, "desc" ]]
      ,"search": {"smart": true  }
    });

});
</script>
